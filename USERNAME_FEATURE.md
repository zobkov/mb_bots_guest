# üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Username –≤ –±–æ—Ç–∞ Management Future '25

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ username –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏ User:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `username: Mapped[str] = mapped_column(String(255), nullable=True)`
- –ü–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å NULL, —Ç–∞–∫ –∫–∞–∫ –Ω–µ —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –µ—Å—Ç—å username

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- –í—ã–ø–æ–ª–Ω–µ–Ω–∞ SQL –∫–æ–º–∞–Ω–¥–∞: `ALTER TABLE users ADD COLUMN username VARCHAR(255)`
- –ü–æ–ª–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω UserRepository**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–∞—Ö:**
```python
async def create(
    self,
    telegram_id: int,
    first_name: str,
    last_name: str,
    email: str,
    workplace: str,
    username: str = None  # ‚Üê –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
) -> User
```

```python
async def update(
    self,
    user: User,
    first_name: str = None,
    last_name: str = None,
    email: str = None,
    workplace: str = None,
    username: str = None  # ‚Üê –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
) -> User
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω UserService**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ get_or_create_user:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `username: str = None`
- Username —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Username –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω Google Sheets Manager**

**–ù–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö:**
```python
headers = [
    "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
    "–ò–º—è", 
    "–§–∞–º–∏–ª–∏—è", 
    "Email", 
    "–ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã/—É—á–µ–±—ã",
    "Telegram ID",
    "Username"  # ‚Üê –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞
]
```

**–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- –í `add_user_to_general_sheet()` –¥–æ–±–∞–≤–ª–µ–Ω `user.username or ""`
- –í `add_user_to_event_sheet()` –¥–æ–±–∞–≤–ª–µ–Ω `user.username or ""`
- –ï—Å–ª–∏ username = None, –≤ —Ç–∞–±–ª–∏—Ü—É –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞

### 5. **–û–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**

**–í app/dialogs/start/handlers.py:**
```python
user = await user_service.get_or_create_user(
    telegram_id=telegram_id,
    first_name=context["first_name"],
    last_name=context["last_name"],
    email=context["email"],
    workplace=context["workplace"],
    username=callback.from_user.username  # ‚Üê –ü–æ–ª—É—á–∞–µ–º –∏–∑ Telegram
)
```

### 6. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞—Ç—Ä–∏–±—É—Ç `event.slug`
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `event.sheet_name`

```python
events.sort(key=lambda event: order_map.get(event.sheet_name, 999))
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
TABLE users (
    id BIGINT PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),           -- ‚Üê –ù–æ–≤–æ–µ –ø–æ–ª–µ
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    workplace VARCHAR(500) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Google Sheets
```
| –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ | –ò–º—è | –§–∞–º–∏–ª–∏—è | Email | –ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã/—É—á–µ–±—ã | Telegram ID | Username |
|------------------|-----|---------|-------|--------------------|-------------|----------|
| 2025-10-06 20:30 | ... | ...     | ...   | ...                | ...         | @username|
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å username:**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –±–æ—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ username —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ username –ø–æ—è–≤–∏–ª—Å—è –≤ Google Sheets

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ username:**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –∞–∫–∫–∞—É–Ω—Ç –±–µ–∑ username
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ –ë–î –∑–∞–ø–∏—Å–∞–Ω NULL
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ Google Sheets –ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞

3. **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
   - –ü–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ username –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**‚úÖ Username —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ:**
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- ‚úÖ Google Sheets (–æ–±—â–∏–π –ª–∏—Å—Ç)  
- ‚úÖ Google Sheets (–ª–∏—Å—Ç—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º username
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é! üöÄ**